<link href="../../../public/css/datagrid/examples-offline.css" rel="stylesheet">
<link href="../../../public/css/datagrid/kendo.common.min.css" rel="stylesheet">
<link href="../../../public/css/datagrid/kendo.rtl.min.css" rel="stylesheet">
<link href="../../../public/css/datagrid/kendo.default.min.css" rel="stylesheet">

<script src="../../../public/javascript/datagrid/kendo.web.min.js"></script>
<script src="../../../public/javascript/datagrid/console.js"></script>        
<script src="../../../public/javascript/datagrid/products.js"></script>        
 
 <style type="text/css">
	.botoesfiltrocima {
		display: inline-block;
		height: 29px;
		margin-top: -6px;
		border-top-left-radius: 20px;
		border-top-right-radius: 20px;
		border-bottom-right-radius: 20px;
		border-bottom-left-radius: 20px;
		margin-right: 10px;
		float: left;
		width: 30px;
		padding: 3px 5px 5px 2px;
	}
	.botoesfiltrobaixo {
		display: inline-block;
		height: 29px;
		margin-top: -6px;
		border-top-left-radius: 20px;
		border-top-right-radius: 20px;
		border-bottom-right-radius: 20px;
		border-bottom-left-radius: 20px;
		margin-right: 10px;
		float: left;
		width: 30px;
		padding: 5px 5px 5px 2px;
	}
</style>
 
<div class="panel panel-default">
	<div class="panel-heading">
		<h3 class="panel-title"><strong>Lista de Escolas</strong></h3>
  	</div>
  	<div class="panel-body">
		<div align="center">
  		 
			<div class="panel panel-default" style="width: 95%" align="left">
				<div class="panel-heading" style="cursor:pointer;" onclick="mostraFiltros();">
					<h3 class="panel-title"><strong>Filtros</strong>
						<div style="float:left; margin-top:0px;"> 
							<button type="submit" title="Ocultar Filtros" id="btnesconde" style="display:none;" class="btn btn-default botoesfiltrocima">
								&nbsp;<span class="glyphicon glyphicon-chevron-up"></span>&nbsp; 
							</button>
							<button type="submit" title="Exibir Filtros" id="btnmostra" class="btn btn-default botoesfiltrobaixo">
								&nbsp;<span class="glyphicon glyphicon-chevron-down"></span>&nbsp;
							</button>
						</div>
					</h3>
			  	</div> 
			  	<div id="divfiltros" class="panel-body" style="display: none;" align="center">
			  		<!-- INICIO -Formulário de pesquisa -->
					<div style="width: 95%;" align="left">
						<div class="row">
							<div class="col-xs-3">
						  		<label for="cod_escola">Código da Escola</label>
						    	<input type="text" id="cod_escola" name="cod_escola" class="form-control" placeholder="Código da Escola">
							</div>
							<div class="col-xs-3">
						  		<label for="nom_escola">Nome da Escola</label>
						    	<input type="text" id="nom_escola" name="nom_escola" class="form-control" placeholder="Nome da Escola">
							</div>
							<div class="col-xs-3">
						  		<label for="cod_rede">Rede</label>
						  		<?php
						  			echo Util::combo('cod_rede', $vars['dadosRede'], true, "Selecione..."); 
						  		?>
							</div>
						  	<div class="col-xs-3">
						  		<label for="cod_dependencia">Dependência</label>
						  		<?php
						  			echo Util::combo('cod_dependencia', $vars['dadosDependencia'], true, "Selecione..."); 
						  		?>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-3">
						  		<label for="cod_regiao">Região</label>
						  		<?php
						  			echo Util::combo('cod_regiao', $vars['dadosRegiao'], true, "Selecione...", "carregaEstados(this);"); 
						  		?>
							</div>
							<div class="col-xs-3">
						  		<label for="cod_estado">Estado</label>
						  		<div id="divestado">
						  		<?php
						  			echo Util::combo('cod_estado', array(), false, "Selecione uma Região", ""); 
						  		?>
						  		</div>
							</div>
							<div class="col-xs-3">
						  		<label for="cod_municipio">Município</label>
						  		<div id="divmunicipio">
						  		<?php
						  			echo Util::combo('cod_municipio', array(), false, "Selecione um Estado", ""); 
						  		?>
						  		</div>
							</div>
						  	<div class="col-xs-3">
						  		<label for="cod_cat_dependencia">Categoria</label>
						  		<?php
						  			echo Util::combo('cod_cat_dependencia', $vars['dadosCategoria'], true, "Selecione..."); 
						  		?>
							</div>
						</div>
						<br>
						<button type="button" class="btn btn-default">Filtrar</button>
						<button type="button" class="btn btn-default">Limpar</button>
					</div>
					<!-- FIM - Formulário de pesquisa -->
				</div>
			</div>
			
			<!-- Grid de escolas -->
			<div id="grid" style="font-size: 11px; width: 95%; ">
				<div id="carregandoLista" style="height:470px;"> <img style="border:0px;" src="<?= IMAGENS; ?>carregando.gif"></div>
			</div>
		</div>
	</div>
</div>       

<script>
    $(document).ready(function() {
		$.ajax({
			type    : "POST",
			async   : true,
			dataType: "json",
			url     : '/escola/carregaEscolas'})
		 .done(function(result){
			 $('#carregandoLista').hide();
			 exibeGrid(result);
		 });
        
    });

    function exibeGrid(escolas){
    	$("#grid").kendoGrid({
            dataSource: {
                data: escolas,
                schema: {
                    model: {
                        fields: {
                        	icone     	   		: {type: "string" },
                        	cod_escola     		: {type: "string" },
                        	nom_escola     		: {type: "string" },
                        	nom_rede	   		: {type: "string" },
                        	nom_dependencia		: {type: "string" },
                        	nom_cat_dependencia	: {type: "string" }
                        }
                    }
                },
                pageSize: 20
            },
            height: 470,
            scrollable: true,
            sortable: true,
            filterable: false,
            pageable: {
                input: true,
                numeric: false
            },
            columns: [
                {field: "icone",
                 template: "<img style='border:0px; cursor:pointer; width:20px; heigth:20px;' title='Clique para exibir informações da escola' src='<?= IMAGENS; ?>iconelupa2.png' onclick='exibeDetalhes(#: cod_escola #)'>", 
                 title: "Ação", 
                 width: "5%", 
                 attributes: { style: "text-align: center; "}},
                {field: "cod_escola", title: "Código", width: "10%", attributes: { style: "text-align: center; font-size: 14px;"}},
                {field: "nom_escola", title: "Nome", width: "40%", attributes: { style: "font-size: 14px; "}},
                {field: "nom_rede", title: "Rede", width: "15%", attributes: { style: "text-align: center;font-size: 14px; "} },
                {field: "nom_dependencia", title: "Dependêcia", width: "15%", attributes: { style: "text-align: center; font-size: 14px;"}},
                {field: "nom_cat_dependencia", title: "Categoria", width: "15%", attributes: { style: "text-align: center; font-size: 14px;"}},
            ]
        });
    
    }

    function exibeDetalhes(cod_escola){
        alert(cod_escola);
		console.log(cod_escola);
    }    

    function carregaEstados(regiao){
        var cod_regiao = regiao.value;

        $('#divestados').load( "/estado/carregaEstados" );
    }    

    function mostraFiltros(){
        if($('#divfiltros:visible').length <= 0){
        	$('#divfiltros').show();
        	$('#btnesconde').show();
        	$('#btnmostra').hide();
        }else{
        	$('#divfiltros').hide();
        	$('#btnesconde').hide();
        	$('#btnmostra').show();
        }    
    }    

</script>

